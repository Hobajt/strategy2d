import cv2
import numpy as np

imgpath = '29468.png'

bg_clr = [83,103,141,0]


vec = [[53, 45], [6, 0], [12, 10], [0], [1, 5]]
vec = [[53, 49], [6, 0], [12, 8], [0, 52, 102, 154, 210], [5, 5]]
vec = [[63, 57], [-2, 0], [3, 270], [0, 59, 123, 179], [4, 5]]
vec = [[49, 57], [71, 0], [14, 505], [0], [1, 3]]
vec = [[53, 57], [8, 0], [12, 505], [0], [1, 4]]
vec = [[45, 49], [19, 0], [16, 568], [0], [1, 2]] 
vec = [[53, 49], [6, 0], [12, 8], [0, 52, 102, 154, 210], [5, 5]] 


imgpath = '29493.png'
vec = [[81, 81], [1, 0], [5, 3], [0, 82, 164, 250], [4, 5]]
vec = [[81, 81], [1, 0], [4, 332], [0, 82, 169], [3, 5]]
vec = [[83, 65], [-3, 0], [3, 588], [0, 55], [2, 5]]

imgpath = 'battleship.png'
vec = [[93, 89], [-3, 0], [0, 1], [0], [1, 5]]
vec = [[89, 85], [1, 0], [0, 98], [0, 101], [2, 5]] 

imgpath = 'footman.png'
vec = [[49, 45], [25, 0], [13, 9], [0], [1, 5]] 
vec = [[55, 53], [19, 0], [10, 5], [0, 59, 115, 166, 214], [5, 5]] 
vec = [[75, 57], [1, 0], [0, 274], [0, 54, 120, 180], [4, 5]] 
vec = [[59, 47], [14, 0], [10, 527], [0, 52], [2, 4]] 


imgpath = 'archer.png'
vec = [[55, 49], [4, 0], [0, 11], [0, 75, 149, 221, 295], [5, 5]]
# vec = [[57, 53], [1, 0], [1, 304], [0, 73, 148], [3, 5]]
vec = [[57, 53], [0, 0], [3, 377], [0, 75], [2, 5]]
# vec = [[57, 49], [0, 0], [4, 526], [0, 58], [2, 4]]

imgpath = 'knight.png'
vec = [[65, 63], [9, 0], [7, 9], [0, 72, 146, 223, 296], [5, 5]] 
vec = [[71, 63], [4, 0], [1, 375], [0, 75, 148, 225], [4, 5]] 
vec = [[71, 59], [-1, 0], [2, 679], [0, 66], [2, 5]]

imgpath = 'ballista.png'
vec = [[63, 61], [3, 0], [1, -1], [0, 66], [2, 5]]
vec = [[63, 61], [3, 0], [1, 65], [0, 66, 132], [3, 5]] 

imgpath = 'demo_squad.png'
vec = [[61, 51], [-3, 0], [0, 0], [0, 52, 101, 152, 202, 251, 303, 359, 412], [9, 5]] 
vec = [[55, 49], [3, 0], [1, 1], [0, 51, 102, 150, 201, 251, 301, 353], [8, 5]] 
vec = [[61, 49], [-3, 0], [0, 413], [0], [1, 5]] 

imgpath = 'destroyer.png'
vec = [[81, 81], [2, 0], [0, 8], [0, 91, 175], [3, 5]]

imgpath = 'machine.png'
vec = [[77, 65], [-3, 0], [2, 9], [0, 77], [2, 5]]
vec = [[77, 73], [-2, 0], [2, 154], [0], [1, 2]] 

imgpath = 'submarine.png'
vec = [[73, 67], [1, 0], [0, 11], [0, 70, 142], [3, 5]] 

imgpath = 'tanker.png'
vec = [[77, 73], [-4, 0], [0, 0], [0, 75, 150, 221], [4, 5]] 

imgpath = 'transport.png'
vec = [[75, 69], [-1, 0], [0, 3], [0, 74, 151], [3, 5]] 

imgpath = 'mage.png'
vec = [[55, 53], [18, 0], [10, 12], [0, 62, 123, 182, 243], [5, 5]] 
# vec = [[71, 53], [4, 0], [0, 312], [0, 60, 122, 188], [4, 5]] 
# vec = [[57, 53], [9, 0], [6, 562], [0, 50], [2, 5]] 

imgpath = 'peasant.png'
vec = [[29, 31], [8, 0], [15, 4], [0, 38, 78, 115, 151], [5, 5]] 
vec = [[55, 41], [2, 0], [0, 187], [0, 35, 76, 121, 169], [5, 5]]
vec = [[41, 35], [9, 0], [4, 407], [0, 41], [2, 3]] 
vec = [[29, 37], [3, 0], [27, 487], [0, 43, 85, 128, 171], [5, 5]] 
vec = [[39, 39], [0, 0], [13, 697], [0, 46, 89, 132, 172], [5, 5]]

imgpath = 'catapult.png'
vec = [[63, 61], [6, 0], [0, 1], [0, 69, 138, 207], [4, 5]]

imgpath = 'death_knight.png'
vec = [[63, 63], [4, 0], [4, 4], [0, 64, 130, 198, 266], [5, 5]]
vec = [[67, 63], [-1, 0], [4, 338], [0, 66, 133, 199], [4, 5]] 
vec = [[71, 61], [-2, 0], [2, 600], [0], [1, 4]]

imgpath = 'dragon.png'
vec = [[95, 79], [-5, 0], [0, 4], [0, 79, 166, 247], [4, 5]] 
vec = [[79, 79], [11, 0], [5, 334], [0], [1, 5]] 
vec = [[81, 79], [8, 0], [6, 418], [0], [1, 5]]

imgpath = 'turtle.png'
vec = [[73, 69], [1, 0], [6, 6], [0, 71, 141], [3, 5]] 

imgpath = 'sappers.png'
vec = [[43, 37], [15, 0], [15, 6], [0, 41, 84, 124, 165, 209], [6, 5]] 
vec = [[57, 45], [1, 0], [8, 255], [0, 46, 97], [3, 5]]
vec = [[65, 45], [-7, 0], [0, 399], [0, 44], [2, 5]] 

imgpath = 'zeppelin.png'
vec = [[73, 73], [1, 0], [0, 2], [0, 74], [2, 5]]

imgpath = 'grunt.png'
vec = [[51, 49], [23, 0], [16, 6], [0, 54, 108, 163, 216], [5, 5]] 
vec = [[77, 51], [-1, 0], [0, 274], [0, 55, 112, 173], [4, 5]]
vec = [[59, 53], [9, 0], [11, 510], [0, 57], [2, 3]]

imgpath = 'ogre.png'
vec = [[65, 57], [9, 0], [4, 4], [0, 74, 148, 223, 297], [5, 5]]
vec = [[69, 57], [5, 0], [2, 373], [0, 73, 147, 222], [4, 5]] 
vec = [[51, 53], [13, 0], [5, 660], [0, 61], [2, 5]]

imgpath = 'juggernaut.png'
vec = [[89, 89], [1, 0], [11, 5], [0], [1, 5]] 
vec = [[97, 73], [-8, 0], [0, 105], [0], [1, 4]]

imgpath = 'tanker.png'
vec = [[67, 65], [7, 0], [1, 3], [0], [1, 5]] 
vec = [[69, 57], [-1, 0], [2, 74], [0], [1, 4]]
vec = [[67, 65], [6, 0], [1, 134], [0], [1, 5]]

imgpath = 'transport.png'
vec = [[73, 69], [1, 0], [0, 2], [0], [1, 5]] 
vec = [[73, 57], [-1, 0], [4, 81], [0], [1, 4]] 

imgpath = 'destroyer.png'
vec = [[91, 85], [-1, 0], [0, 4], [0], [1, 5]] 
vec = [[81, 67], [7, 0], [4, 96], [0], [1, 4]] 

imgpath = 'peon.png'
vec = [[45, 37], [4, 0], [32, 0], [0, 39, 81, 121, 163], [5, 5]]
vec = [[63, 47], [-3, 0], [0, 204], [0, 51, 101, 153, 199], [5, 5]] 
vec = [[35, 37], [10, 0], [38, 453], [0, 40], [2, 3]]
vec = [[33, 37], [3, 0], [59, 535], [0, 40, 85, 127, 170], [5, 5]]
vec = [[49, 41], [2, 0], [25, 748], [0, 46, 91, 137, 185], [5, 5]]

imgpath = 'skeleton.png'
vec = [[41, 41], [20, 0], [8, 5], [0, 45, 92, 136, 183], [5, 5]]
vec = [[53, 45], [10, 0], [0, 236], [0, 52, 108, 152], [4, 5]] 
vec = [[43, 41], [17, 0], [5, 441], [0], [1, 5]] 

imgpath = 'daemon.png'
vec = [[61, 57], [15, 0], [7, 6], [0, 77, 156, 235, 311], [5, 5]] 
vec = [[61, 57], [15, 0], [7, 392], [0, 77, 156, 231, 308], [5, 5]]
vec = [[55, 53], [16, 0], [15, 780], [0], [1, 5]] 

imgpath = 'critters.png'
vec = [[37, 33], [-1, 0], [3, 10], [0, 43, 88], [3, 6]] 

imgpath = 'effects.png'
vec = [[15, 11], [3, 0], [9, 14], [0], [1, 3]]                  #cannon ball
vec = [[17, 15], [5, 0], [72, 9], [0], [1, 4]]                  #ignited cannon ball
vec = [[35, 33], [3, 0], [2, 80], [0], [1, 4]]                  #small explosion
vec = [[33, 31], [-1, 0], [157, 1], [0, 33, 65], [3, 5]]        #catapult shot
vec = [[40, 37], [1, 0], [325, 14], [0], [1, 5]]                #balista shot
vec = [[53, 49], [-2, 2], [170, 108], [0], [1, 6]]              #explosion small
vec = [[49, 49], [6, 0], [531, 2], [0, 54], [2, 5]]             #fire big
vec = [[33, 31], [-1, 0], [-1, 123], [0], [1, 5]]               #eye
vec = [[33, 33], [7, 0], [328, 68], [0], [1, 5]]                #submarine shot
vec = [[65, 59], [0, 0], [0, 171], [0], [1, 16]]                #explosion big
vec = [[31, 25], [1, 0], [605, 122], [0], [1, 6]]               #fire small
vec = [[33, 33], [3, 0], [810, 58], [0], [1, 5]]                #fireball
vec = [[39, 31], [5, 0], [813, 8], [0], [1, 3]]                 #storm hammer
vec = [[21, 21], [9, 0], [958, 15], [0], [1, 3]]                #axe
vec = [[31, 29], [9, 0], [807, 117], [0], [1, 5]]               #arrow
vec = [[23, 25], [9, 0], [514, 255], [0], [1, 5]]               #death coil shot
vec = [[35, 25], [1, 0], [682, 255], [0], [1, 5]]               #death coil hit
vec = [[25, 25], [7, 0], [932, 257], [0], [1, 5]]               #lightning bolt
vec = [[40, 33], [-4, 0], [925, 293], [0], [1, 5]]              #lightning hit
vec = [[29, 29], [10, 0], [156, 252], [0], [1, 6]]              #spell buzz
vec = [[47, 45], [1, 0], [2, 304], [0], [1, 6]]                 #healing buzz
vec = [[48, 45], [-0, 0], [327, 309], [0], [1, 6]]              #dark buzz
vec = [[21, 15], [-2, 0], [415, 258], [0], [1, 4]]              #runes
vec = [[57, 55], [7, 0], [657, 299], [0], [1, 4]]               #tornado
vec = [[27, 21], [11, 0], [4, 42], [0], [1, 4]]                 #small smoky explosion
vec = [[51, 49], [-2, 0], [999, 46], [0, 57], [2, 2]]           #death & decay
vec = [[21, 27], [8, 0], [497, 123], [0], [1, 3]]               #fiery fart
vec = [[31, 33], [2, 0], [0, 250], [0], [1, 4]]                 #blizzard
vec = [[16,16], [2, 0], [867, 251], [0, 18], [2, 3]]            #buff icons

imgpath = 'output.png'
vec = [[45, 39], [27, 0], [9, 9], [0, 47, 98, 137, 179, 222], [6, 2]] 
vec = [[57, 43], [-57, 0], [40, 273], [0], [1, 1]] 

imgpath = 'buildings.png'
vec = [[99,93], [0,0], [12, 10], [0, 96], [2,3]]            #gm
vec = [[96,95], [2,0], [11,204], [0], [1,2]]                #oil
vec = [[65,64], [5,5],[441,8], [0,68], [2,2]]               #ruins ground
vec = [[68,62],[0,0],[582,5], [0, 65], [2,1]]               #construction winter
vec = [[68,57],[0,0],[582,138], [0, 66], [2,1]]             #construction summer
vec = [[66,62],[0,0],[441,140],[0,65],[2,1]]                #ruins water
vec = [[36,36], [0,0], [517,148], [0, 34, 70, 105], [4,1]]  #ruins small
vec = [[64,61], [0,0], [302,279], [0], [1,1]]               #circle

imgpath = '29500.png'
vec = [[46,38], [3,3], [6,5], [0, 41, 82, 123, 164], [18,10]]

################

win_name = 'patch'
w,h = vec[0]            #size
ox,oy = vec[1]          #step-offset
ix,iy = vec[2]          #init-offset
y_coord = vec[3]
r,c = vec[4]
i,j = 0,0

show_alpha = False

img = cv2.imread(imgpath, cv2.IMREAD_UNCHANGED)

cv2.namedWindow(win_name, cv2.WINDOW_NORMAL)
cv2.resizeWindow(win_name, (256, 256))

running = True

def terminate():
    global running
    running = False

def patch_left():
    global i, j
    j = (j-1) if j > 0 else 0
    print(f"coord: [{i}, {j}]")

def patch_right():
    global i, j
    j = (j+1) if j < (c-1) else (c-1)
    print(f"coord: [{i}, {j}]")

def patch_up():
    global i, j
    i = (i-1) if i > 0 else 0
    print(f"coord: [{i}, {j}]")

def patch_down():
    global i, j
    i = (i+1) if i < (r-1) else (r-1)
    print(f"coord: [{i}, {j}]")

def inc_width():
    global h,w
    w += 1

def dec_width():
    global h,w
    w = (w-1) if w > 0 else 0

def inc_height():
    global h,w
    h += 1

def dec_height():
    global h,w
    h = (h-1) if h > 0 else 0

def dec_offset():
    global oy,ox
    oy = ox = (ox-1) if ox > 0 else 0

def inc_offset():
    global oy,ox
    oy = ox = ox+1

def toggle_alpha():
    global show_alpha
    show_alpha = not show_alpha


handlers = {
    ord('q'): terminate,
    ord('w'): patch_up,
    ord('s'): patch_down,
    ord('a'): patch_left,
    ord('d'): patch_right,
    ord('j'): dec_width,
    ord('l'): inc_width,
    ord('i'): inc_height,
    ord('k'): dec_height,
    ord('o'): dec_offset,
    ord('p'): inc_offset,
    ord('t'): toggle_alpha,
}

while running:
    oh,ow = h+oy, w+ox
    # patch = np.array(img[iy+oh*i:iy+oh*i+h, ix+ow*j:ix+ow*j+w])
    y = iy+y_coord[i]
    patch = np.array(img[y:y+h, ix+ow*j:ix+ow*j+w])

    print(f"coord [{i}, {j}], s: ({h}, {w})")

    if not show_alpha:
        patch[patch[...,-1] == 0] = bg_clr

    cv2.imshow(win_name, patch)
    key = cv2.waitKey(0)
    
    if key in handlers:
        handlers[key]()

    